# =============================================================================
# 数据库连接配置
# =============================================================================

# -----------------------------------------------------------------------------
# MySQL 配置 - 用于存储稽核结果
# -----------------------------------------------------------------------------
mysql:
  host: "localhost"
  port: 3306
  database: "data_audit"
  user: "audit_user"
  password: "your_password_here"
  charset: "utf8mb4"

# -----------------------------------------------------------------------------
# ClickHouse 配置 - 用于从调度平台获取已完成任务清单
# -----------------------------------------------------------------------------
clickhouse:
  # ClickHouse 集群节点（任选一个节点连接即可，Native 协议默认端口 9000）
  # 可用节点: 10.252.115.31, 10.252.115.35, 10.252.115.52
  host: "10.252.115.31"
  port: 9000                    # Native 协议端口，HTTP 端口通常是 8123
  database: "uops_daas"
  user: "default"              # 根据实际情况修改
  password: ""                 # 根据实际情况修改
  # 时区口径（可选）：用于把 hours_lookback 的窗口与 ClickHouse 的 end_time 对齐
  # 常见取值: "Asia/Shanghai", "UTC"
  timezone: "Asia/Shanghai"
  # -----------------------------------------------------------------------------
  # Watermark 增量拉取（推荐开启，用于“保证不漏/不断点”）
  # -----------------------------------------------------------------------------
  # 说明：
  #   - 启用后，会把上次成功运行的窗口 end_time 持久化到文件（watermark_path）
  #   - 下次从该时间点继续查询：end_time >= last_end_time AND end_time < now
  #   - 并额外回扫 watermark_overlap_seconds，用于抵抗 ClickHouse 写入/同步延迟
  #
  # 可选配置：
  watermark_enabled: true
  watermark_path: "../state/clickhouse_watermark.json"
  watermark_overlap_seconds: 600   # 默认 10 分钟
  # 当 watermark 距离当前时间太久（例如停跑 3 天），为了避免一次性回补过大窗口导致压力过高，
  # 会把单次查询窗口限制为 watermark_max_window_hours（成功后 watermark 推进到该窗口 end_time，
  # 下次继续追赶，直到追平当前时间）。
  watermark_max_window_hours: 24.0
  # 查询已完成任务的 SQL 模板
  # 可用变量: {start_time}, {end_time}, {data_date}
  # 返回字段: task_name, period_type, batch_no（用于解析业务日期）
  query_template: |
    SELECT job_code AS task_name, 
           batch_type AS period_type, 
           batch_no
    FROM uops_daas.ods_all_dacp_dataflow_job_trigger_rt
    WHERE state = 1
      AND complete_dt >= '{start_time}'
      AND complete_dt < '{end_time}'

# =============================================================================
# 配置说明
# =============================================================================
# 
# MySQL 配置:
#   host:     MySQL 服务器地址
#   port:     MySQL 端口，默认 3306
#   database: 数据库名称
#   user:     数据库用户名
#   password: 数据库密码
#   charset:  字符集，推荐 utf8mb4
#
# ClickHouse 配置:
#   host:     ClickHouse 服务器地址
#   port:     ClickHouse Native 协议端口，默认 9000
#   database: 调度平台数据库名称
#   user:     ClickHouse 用户名
#   password: ClickHouse 密码
#   query_template: 查询已完成任务的 SQL 模板
#                   - 需返回 task_name 字段
#                   - 支持 {start_time}, {end_time} 变量
#
# 安全提示:
#   - 生产环境建议使用环境变量或密钥管理服务存储密码
#   - 不要将包含真实密码的配置文件提交到版本控制系统
# =============================================================================
